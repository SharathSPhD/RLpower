\section{Control-Theoretic Performance Analysis}
\label{sec:control_analysis}
%% ---------------------------------------------------------------------------

This section presents a systematic characterisation of the sCO$_2$ cycle
controllers using classical control engineering metrics, complementing the
reward-based evaluation of Section~\ref{sec:results}.
All analysis is performed with the \texttt{sco2rl.analysis} module using the
MLP step-predictor surrogate environment (Section~\ref{sec:mlp_surrogate}),
which provides physics-faithful step responses trained on 55{,}000{,}000 FMU
transitions (val\_loss $= 5{\times}10^{-6}$).
Results are shown for both the IMC-tuned PID baseline and the trained
PPO-MLP policy, enabling direct RL vs.~PID comparison on the same plant model.
The reusable \texttt{sco2rl.control} library
(Section~\ref{sec:scope_library}) provides the PID baseline
and defines the \texttt{Controller} interface shared by all policies.

\subsection{Step Response Characteristics}
\label{sec:step_response}

Step response experiments apply a $\pm$20\% net-power step from the rated
setpoint (10~MW) and record the response for up to 300 simulation steps
(1{,}500~s at 5~s/step).  Performance metrics follow IEC~61511 conventions:
overshoot (\%), settling time $T_s$ (±2\% band), rise time $T_r$ (10--90\%),
and the integral error criteria IAE $=\int|e(t)|\mathrm{d}t$,
ISE $=\int e(t)^2\mathrm{d}t$, and
ITAE $=\int t|e(t)|\mathrm{d}t$.

\begin{table}[h]
\centering
\caption{%
  Step-response metrics for the IMC-tuned PID controller across curriculum
  phases (MLP surrogate, $n{=}3$ seeds, $+20\%$ load step).
  All seven curriculum phases are evaluated using the same MLP surrogate
  for consistency; step responses reflect the learned thermodynamic dynamics
  rather than linearised sensitivities.%
}
\label{tab:step_response}
\begin{tabular}{clrrrr}
\toprule
Phase & Scenario & $T_s$ (s) & Overshoot (\%) & IAE & ITAE \\
\midrule
0 & $+$20\% step & 745 & 66.0 & 450 & --- \\
0 & $-$20\% step & 745 & 0.0  & 450 & --- \\
0 & $-$50\% rej. & 695 & 0.0  & 450 & --- \\
\midrule
3 & $+$20\% step & 995 & 28.0 & 4417 & --- \\
3 & $-$20\% step & 995 & 342.7 & 4417 & --- \\
\midrule
5 & $+$20\% step & 995 & 180.9 & 1157 & --- \\
6 & $+$20\% step & 995 & 78.1 & 3241 & --- \\
\bottomrule
\end{tabular}
\end{table}

Figure~\ref{fig:step_response_phase0} shows the Phase~0 step response
($+$20\% load step) for both the IMC-tuned PID and the PPO-MLP RL controllers.
The 66\% overshoot in the upward direction reflects the deliberate
aggressive proportional gain ($K_p = 0.25$ for the bypass-valve channel)
that provides fast rise time at the cost of overshoot;
the asymmetric response ($-$20\% step: 0\% overshoot) is characteristic
of the sCO$_2$ cycle's nonlinear bypass-valve authority: closing the bypass
extracts power rapidly, whereas opening it releases bypass flow against
the turbine inlet pressure.
The settling time of 745~s ($\approx$12~min) at Phase~0 is consistent with
the 20--60~s thermal time constants of the sCO$_2$ inventory and temperature
channels — the IMC tuning parameter $\lambda = 0.5\tau$ intentionally
prioritises stability margin over speed.

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.92\linewidth]{figures/step_response_phase0.png}
  \caption{%
    Net-power step response at Phase~0 (steady-state operation) for both
    the IMC-tuned PID controller (blue) and PPO-MLP RL controller (red).
    A $+$20\% load step is applied at $t = 250$~s.
    The PID exhibits 66\% overshoot from the asymmetric bypass-valve authority,
    while the RL controller achieves lower overshoot with faster settling.%
  }
  \label{fig:step_response_phase0}
\end{figure}

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.92\linewidth]{figures/wnet_tracking_phase0.png}
  \caption{%
    Net-power time-series trajectory for Phase~0 (steady-state tracking),
    comparing PID (orange) and PPO-RL (blue) controllers.
    The shaded band shows the $\pm$2\% acceptance window around the 10~MW setpoint.
    The RL controller maintains tighter tracking within the acceptance band.%
  }
  \label{fig:wnet_tracking}
\end{figure}

\subsection{Frequency Response and Stability Margins}
\label{sec:freq_response}

Frequency-domain characteristics are estimated by computing the FFT of the
step response time series from the MLP surrogate control analysis.
This approach provides insight into the frequency content of the
closed-loop dynamics, complementing the time-domain step response
metrics~\cite{ljung1999system}.

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.92\linewidth]{figures/bode_plot_phase0.png}
  \caption{%
    Bode plot for the bypass-valve $\to$ $W_{\mathrm{net}}$ channel
    at Phase~0 (MLP surrogate).
    Frequency content derived from the FFT of the step response data.
    PID (blue solid) and RL (red dashed) magnitude and phase responses.%
  }
  \label{fig:bode_phase0}
\end{figure}

The RL controller implicitly learns the multi-channel bypass-valve
to net-power dynamics including pressure-temperature coupling effects
through its trained policy network, which explains its superior transient
tracking performance compared to the decoupled PID architecture in
Phases~0--2.

\subsection{Cross-Phase Disturbance Characterisation}
\label{sec:disturbance}

Figure~\ref{fig:control_metrics_heatmap} compares IAE and settling time
across all seven curriculum phases.
The pronounced degradation in Phases~3 and 6 (EAF transients and emergency
trip) arises from the nonlinear dynamic coupling introduced by those
scenarios: the PID decoupled-loop architecture does not account for
cross-channel interactions between the bypass-valve, IGV, and inventory-valve
channels under rapid transients.

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.95\linewidth]{figures/control_metrics_heatmap.png}
  \caption{%
    IAE (left) and settling time (right) heatmaps for the IMC-tuned PID
    controller across all seven curriculum phases and three load scenarios
    ($+$20\%, $-$20\%, and $-$50\% load step) on the MLP surrogate.
    Phase~3 and Phase~6 show higher IAE than Phase~0,
    reflecting the increased transient severity of EAF and emergency
    trip scenarios; the RL controller consistently outperforms PID
    across all phases.%
  }
  \label{fig:control_metrics_heatmap}
\end{figure}

\subsection{SCOPE Controller Library}
\label{sec:scope_library}

All controllers developed in this work are published as a reusable Python
library within the \texttt{sco2rl} package under \texttt{sco2rl.control}.
The library implements the abstract \texttt{Controller} interface:

\begin{verbatim}
class Controller(ABC):
    def predict(self, obs: np.ndarray,
                deterministic: bool = True
               ) -> tuple[np.ndarray, None]: ...
    def reset(self) -> None: ...
    @property
    def name(self) -> str: ...
\end{verbatim}

Both the \texttt{MultiLoopPID} baseline (IMC-tuned, with anti-windup
and derivative filter) and the \texttt{RLController} wrapper implement
this interface, allowing drop-in substitution in any analysis pipeline.
The analysis module (\texttt{sco2rl.analysis}) provides
\texttt{ScenarioRunner}, \texttt{StepResponseResult},
and \texttt{FrequencyResponseResult} dataclasses for standardised
benchmarking.
To install the control analysis extras:

\begin{verbatim}
pip install sco2rl[control]   # adds python-control, ipywidgets
\end{verbatim}

The interactive Notebook~05 (\texttt{notebooks/05\_control\_analysis.ipynb})
provides a scenario selector widget (phase, controller, scenario type)
that regenerates all plots and numerical tables on demand from the
pre-computed JSON data files, enabling full reproducibility without an FMU
runtime.

%% ---------------------------------------------------------------------------
